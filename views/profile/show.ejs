<%- include('../partials/html-head') %>
<link rel="stylesheet" href="../stylesheets/index.css">
<%- include('../partials/nav') %>

<main>
  <div class="page-top">
    <h1><%= title %></h1>
    <div>
      <img src="<%= profile.avatar %>" alt="Avatar image of <%= profile.name %>">
    </div>
    <div>
      <% if (profile._id.equals(user?.profile._id)) { %>
        
      <% } else if (profile.friends.includes(user?.profile._id)) { %>
        <h6>You and <%= profile.name %> are friends!</h6>
      <% } else if (profile.friendRequests.includes(userProfile.friendCode)) { %>
        <h6>Friend Request to <%= profile.name %> Pending</h6>
      <% } else if (userProfile.friendRequests.includes(profile.friendCode)) { %>
        <h6><%= profile.name %> Sent You a Friend Request!</h6>
        <a href="/profile/<%= userProfile._id %>/friendRequests"><button>View Request</button></a>
      <% } else { %> 
        <form action="/profile/<%= profile._id %>/sendFriendRequest?_method=PATCH" method="POST"><button type="submit">Add Friend</button></form>
      <% } %> 
      </div>
    <section>
      <% if (profile.dogs) { %>
        <h3>Dogs:</h3>
      <% } %>
      <% profile.dogs.forEach(dog => { %>
        <h5><a href="/dogs/<%= dog._id %>"><%= dog.name %></a></h5>
        <ul>
          <li>Breed: <%= dog.breed %></li>
          <% if (dog.color) { %>
            <li>Color: <%= dog.color %> </li>
            <% } %>
          </ul>
          <% }) %>
          <% if (profile._id.equals(user?.profile._id)) { %>
            <a href="/dogs/new">
              <button>Add Dog</button>
            </a>
            <a href="/profile/<%= profile._id %> %>/edit">
              <button>Edit Profile</button>
            </a>
            <% } %>
    </section>
    <% if (profile._id.equals(user?.profile._id)) { %>
      <section>
        <a href="/blogs/new"><button>Write new Blog</button></a>
      </section>
      <% } %>
  </div>
  <section>
    <% if (profile._id.equals(user?.profile._id)) { %>    
      <h2>Your Blogs:</h2>
      <% } else { %>
        <h2><%= profile.name %>'s Blogs:</h2>
        <% } %> 
    <% profile.blogPosts.forEach(blog => { %>
      <div>
        <h3>
          <a href="/blogs/<%= blog._id %>">
            <%= blog.title %>
          </a>
        </h3>
        <h4><%= blog.summary %></h4>
      </div>
        <% }) %>
  </section>
</main>

<%- include('../partials/footer') %>